<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>步骤化 Text2SQL 演示</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism.min.css" rel="stylesheet">
    <style>
        .query-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            text-align: center;
        }
        .step-card {
            margin-bottom: 0.5rem;
            border-left: 4px solid #e9ecef;
        }
        .step-card.active {
            border-left-color: #007bff;
        }
        .step-card.completed {
            border-left-color: #28a745;
            background-color: #f8fff9;
        }
        .step-card.failed {
            border-left-color: #dc3545;
            background-color: #fff8f8;
        }
        .step-header {
            cursor: pointer;
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 5px;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
        }
        .step-content {
            padding: 0.75rem;
            background: white;
            border-radius: 5px;
            margin-top: 0.25rem;
        }
        .step-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background: #6c757d;
            color: white;
            border-radius: 50%;
            margin-right: 1rem;
            font-weight: bold;
            font-size: 0.9em;
        }
        .step-number.active {
            background: #007bff;
        }
        .step-number.completed {
            background: #28a745;
        }
        .step-number.failed {
            background: #dc3545;
        }
        .sql-code {
            background: #f8f9fa;
            color: #333;
            padding: 0.75rem;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 0.5rem 0;
            border: 1px solid #e9ecef;
        }
        .blockquote {
            background: #f8f9fa;
            border-left: 4px solid #6c757d;
            padding: 0.5rem 0.75rem;
            margin: 0.5rem 0;
            border-radius: 0 5px 5px 0;
            font-style: italic;
            font-size: 0.9em;
        }
        .table-container {
            max-height: 400px;
            overflow-y: auto;
        }
        .loading {
            display: none;
        }
        .progress-container {
            margin-bottom: 2rem;
        }
        .example-queries {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }
        .example-query {
            cursor: pointer;
            padding: 0.5rem;
            margin: 0.25rem 0;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .example-query:hover {
            background: #f0f0f0;
        }
        .status-icon {
            font-size: 1.2em;
            padding: 0.3rem;
            border-radius: 50%;
            background: white;
        }
        .step-description {
            color: #6c757d;
            font-size: 0.9em;
            margin-top: 0.5rem;
        }
        .result-data {
            max-height: 300px;
            overflow-y: auto;
        }
        .step-brief-info {
            background: #e3f2fd;
            padding: 0.75rem;
            border-radius: 5px;
            border-left: 4px solid #2196f3;
            font-size: 1.1em;
        }
        .step-detailed-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 5px;
            border: 1px solid #e9ecef;
            margin-top: 0.5rem;
        }
        .step-detailed-info pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 0.5rem 0;
            overflow-x: auto;
        }
        
        /* 步骤5执行结果特殊样式 */
        .step-card.execution-result {
            border-left-width: 6px;
        }
        
        .step-card.execution-success {
            border-left-color: #28a745;
            background: linear-gradient(135deg, #f8fff9 0%, #e8f5e8 100%);
        }
        
        .step-card.execution-failed {
            border-left-color: #dc3545;
            background: linear-gradient(135deg, #fff8f8 0%, #ffe8e8 100%);
        }
        
        .step-card.execution-result .step-header {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            font-weight: 600;
        }
        
        .step-card.execution-success .step-header strong {
            color: #155724;
        }
        
        .step-card.execution-failed .step-header strong {
            color: #721c24;
        }
        
        /* 列表样式优化 */
        .step-detailed-info ul {
            margin-bottom: 0.5rem;
        }
        
        .step-detailed-info ul li {
            margin-bottom: 0.25rem;
        }
        
        .step-detailed-info ul li.ml-3 {
            margin-left: 1rem;
            position: relative;
        }
        
        .step-detailed-info ul li.ml-3::before {
            content: "•";
            color: #6c757d;
            position: absolute;
            left: -0.75rem;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <!-- 头部 -->
                <div class="query-container">
                    <h1 class="display-4 mb-4">
                        <i class="fas fa-robot"></i> 步骤化 Text2SQL 演示
                    </h1>
                    <p class="lead">体验 AI 将自然语言转换为 SQL 的5个详细步骤</p>
                </div>

                <!-- 查询输入区域 -->
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-search"></i> 自然语言查询</h5>
                            </div>
                            <div class="card-body">
                                <form id="queryForm">
                                    <div class="mb-3">
                                        <label for="queryInput" class="form-label">请输入您的查询需求：</label>
                                        <textarea class="form-control" id="queryInput" rows="3"
                                                placeholder="例如：查询所有技术部的员工信息">查询员工表中工资最高的前5条记录</textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <span class="loading spinner-border spinner-border-sm me-2" role="status"></span>
                                        <i class="fas fa-magic me-2"></i>查询
                                    </button>
                                </form>
                            </div>
                        </div>

                        <!-- 示例查询 -->
                        <div class="example-queries">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="mb-0"><i class="fas fa-lightbulb"></i> 示例查询（点击使用）</h6>
                                <button class="btn btn-sm btn-outline-primary" type="button" data-bs-toggle="collapse" 
                                        data-bs-target="#exampleQueriesCollapse" aria-expanded="false" 
                                        aria-controls="exampleQueriesCollapse">
                                    <i class="fas fa-chevron-down" id="collapseIcon"></i>
                                </button>
                            </div>
                            <div class="collapse" id="exampleQueriesCollapse">
                                <div class="mt-3">
                                    <div class="example-query" onclick="setQuery('查询所有员工的姓名和工资')">
                                        查询所有员工的姓名和工资
                                    </div>
                                    <div class="example-query" onclick="setQuery('找出工资最高的前5名员工')">
                                        找出工资最高的前5名员工
                                    </div>
                                    <div class="example-query" onclick="setQuery('统计每个部门的员工数量')">
                                        统计每个部门的员工数量
                                    </div>
                                    <div class="example-query" onclick="setQuery('查询正在进行中的项目信息')">
                                        查询正在进行中的项目信息
                                    </div>
                                    <div class="example-query" onclick="setQuery('找出参与项目最多的5名员工')">
                                        找出参与项目最多的5名员工
                                    </div>
                                    <div class="example-query" onclick="setQuery('计算所有员工的平均工资')">
                                        计算所有员工的平均工资
                                    </div>
                                    <div class="example-query" onclick="setQuery('查询2022年入职的员工')">
                                        查询2022年入职的员工
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h6><i class="fas fa-info-circle"></i> 处理步骤说明</h6>
                            </div>
                            <div class="card-body">
                                <div class="step-description">
                                    <strong>步骤1：问题改写</strong><br>
                                    将用户的自然语言查询改写为更清晰、更具体的查询描述
                                </div>
                                <div class="step-description">
                                    <strong>步骤2：数据表选取</strong><br>
                                    使用 MCP 工具选择相关的数据表
                                </div>
                                <div class="step-description">
                                    <strong>步骤3：信息推理</strong><br>
                                    分析字段需求、条件需求和关联关系
                                </div>
                                <div class="step-description">
                                    <strong>步骤4：SQL生成</strong><br>
                                    基于分析结果生成标准的 SQL 查询语句
                                </div>
                                <div class="step-description">
                                    <strong>步骤5：SQL执行</strong><br>
                                    执行生成的 SQL 查询并返回结果
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- 步骤结果区域 -->
                <div id="stepsContainer" style="display: none;">
                    <!-- 步骤1: 问题改写 -->
                    <div class="card step-card" id="step1Card">
                        <div class="step-header" onclick="toggleStep('step1')">
                            <span class="step-number" id="step1Number">1</span>
                            <strong>问题改写</strong>
                            <span class="status-icon" id="step1Status"></span>
                        </div>
                        <div class="step-content" id="step1Content" style="display: none;">
                            <div id="step1Result"></div>
                        </div>
                    </div>

                    <!-- 步骤2: 数据表选取 -->
                    <div class="card step-card" id="step2Card">
                        <div class="step-header" onclick="toggleStep('step2')">
                            <span class="step-number" id="step2Number">2</span>
                            <strong>数据表选取</strong>
                            <span class="status-icon" id="step2Status"></span>
                        </div>
                        <div class="step-content" id="step2Content" style="display: none;">
                            <div id="step2Result"></div>
                        </div>
                    </div>

                    <!-- 步骤3: 信息推理 -->
                    <div class="card step-card" id="step3Card">
                        <div class="step-header" onclick="toggleStep('step3')">
                            <span class="step-number" id="step3Number">3</span>
                            <strong>信息推理</strong>
                            <span class="status-icon" id="step3Status"></span>
                        </div>
                        <div class="step-content" id="step3Content" style="display: none;">
                            <div id="step3Result"></div>
                        </div>
                    </div>

                    <!-- 步骤4: SQL生成 -->
                    <div class="card step-card" id="step4Card">
                        <div class="step-header" onclick="toggleStep('step4')">
                            <span class="step-number" id="step4Number">4</span>
                            <strong>查询SQL生成</strong>
                            <span class="status-icon" id="step4Status"></span>
                        </div>
                        <div class="step-content" id="step4Content" style="display: none;">
                            <div id="step4Result"></div>
                        </div>
                    </div>

                    <!-- 步骤5: SQL执行 -->
                    <div class="card step-card" id="step5Card">
                        <div class="step-header" onclick="toggleStep('step5')">
                            <span class="step-number" id="step5Number">5</span>
                            <strong>执行SQL</strong>
                            <span class="status-icon" id="step5Status"></span>
                        </div>
                        <div class="step-content" id="step5Content" style="display: none;">
                            <div id="step5Result"></div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://kit.fontawesome.com/your-fontawesome-kit.js" crossorigin="anonymous"></script>

    <script>
        // 设置查询内容
        function setQuery(query) {
            document.getElementById('queryInput').value = query;
        }

        // 处理折叠按钮图标旋转
        document.addEventListener('DOMContentLoaded', function() {
            const collapseElement = document.getElementById('exampleQueriesCollapse');
            const collapseIcon = document.getElementById('collapseIcon');
            
            if (collapseElement && collapseIcon) {
                collapseElement.addEventListener('show.bs.collapse', function () {
                    collapseIcon.style.transform = 'rotate(180deg)';
                });
                
                collapseElement.addEventListener('hide.bs.collapse', function () {
                    collapseIcon.style.transform = 'rotate(0deg)';
                });
            }
        });

        // 切换步骤显示/隐藏
        function toggleStep(stepId) {
            const content = document.getElementById(stepId + 'Content');
            const result = document.getElementById(stepId + 'Result');
            
            // 只有当有详细信息时才允许折叠
            if (result.innerHTML.trim()) {
                if (content.style.display === 'none') {
                    content.style.display = 'block';
                } else {
                    content.style.display = 'none';
                }
            }
        }

        // 更新步骤状态
        function updateStepStatus(stepId, status, content) {
            const card = document.getElementById(stepId + 'Card');
            const number = document.getElementById(stepId + 'Number');
            const statusIcon = document.getElementById(stepId + 'Status');
            const resultDiv = document.getElementById(stepId + 'Result');
            const contentDiv = document.getElementById(stepId + 'Content');
            const titleStrong = card.querySelector('.step-header strong');

            // 移除所有状态类
            card.classList.remove('active', 'completed', 'failed');
            number.classList.remove('active', 'completed', 'failed');

            if (status === 'success') {
                card.classList.add('completed');
                number.classList.add('completed');
                statusIcon.innerHTML = '<i class="fas fa-check-circle text-success"></i>';
            } else if (status === 'error') {
                card.classList.add('failed');
                number.classList.add('failed');
                statusIcon.innerHTML = '<i class="fas fa-times-circle text-danger"></i>';
            } else {
                // 处理其他状态（如 pending, processing 等）
                card.classList.remove('active', 'completed', 'failed');
                number.classList.remove('active', 'completed', 'failed');
                statusIcon.innerHTML = '<i class="fas fa-clock text-secondary"></i>';
            }

            if (content) {
                // 解析内容，分离第一行和其余内容
                const lines = content.split('\n');
                const firstLine = lines[0] || '';
                const detailedInfo = lines.slice(1).join('\n').trim();
                
                // 将第一行内容显示在标题中
                if (firstLine) {
                    titleStrong.innerHTML = convertMarkdownToHtml(firstLine);
                }
                
                // 如果有详细信息，显示在content区域并允许折叠
                if (detailedInfo) {
                    resultDiv.innerHTML = convertMarkdownToHtml(detailedInfo);
                    contentDiv.style.display = 'block';
                } else {
                    // 如果没有详细信息，隐藏content区域
                    contentDiv.style.display = 'none';
                }
                
                // 特殊处理步骤5的执行状态
                if (stepId === 'step5' && (firstLine.includes('执行成功') || firstLine.includes('执行失败'))) {
                    // 为步骤5添加特殊的样式类
                    card.classList.add('execution-result');
                    if (firstLine.includes('执行成功')) {
                        card.classList.add('execution-success');
                    } else if (firstLine.includes('执行失败')) {
                        card.classList.add('execution-failed');
                    }
                }
            }
            
            // 隐藏状态图标
            statusIcon.style.display = 'none';
        }


        // 处理查询表单提交
        document.getElementById('queryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const query = document.getElementById('queryInput').value.trim();
            if (!query) {
                alert('请输入查询内容');
                return;
            }

            // 重置状态
            resetSteps();
            
            // 隐藏步骤容器，等待查询成功后再显示
            document.getElementById('stepsContainer').style.display = 'none';
            

            // 显示加载状态
            const submitBtn = document.querySelector('button[type="submit"]');
            const loading = submitBtn.querySelector('.loading');
            loading.style.display = 'inline-block';
            submitBtn.disabled = true;

            // 发送查询请求
            fetch('/api/steps/query', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ query: query })
            })
            .then(response => response.json())
            .then(data => {
                displayStepResults(data);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('查询失败：' + error.message);
            })
            .finally(() => {
                // 隐藏加载状态
                loading.style.display = 'none';
                submitBtn.disabled = false;
            });
        });

        // 重置步骤状态
        function resetSteps() {
            for (let i = 1; i <= 5; i++) {
                const card = document.getElementById('step' + i + 'Card');
                // 移除所有特殊样式类
                card.classList.remove('execution-result', 'execution-success', 'execution-failed', 'completed', 'failed', 'active');
                // 重置步骤状态
                updateStepStatus('step' + i, 'pending', '');
                document.getElementById('step' + i + 'Content').style.display = 'none';
                // 显示所有步骤卡片
                card.style.display = 'block';
            }
        }

        // 隐藏指定范围的步骤
        function hideSteps(startStep, endStep) {
            for (let i = startStep; i <= endStep; i++) {
                const card = document.getElementById('step' + i + 'Card');
                card.style.display = 'none';
            }
        }

        // 显示步骤结果
        function displayStepResults(data) {
            // 总是显示步骤容器，无论成功还是失败
            document.getElementById('stepsContainer').style.display = 'block';
            
            // 等待所有步骤完成后一次性显示
            setTimeout(() => {
                try {
                    // 先隐藏所有步骤
                    for (let i = 1; i <= 5; i++) {
                        document.getElementById('step' + i + 'Card').style.display = 'none';
                    }

                    // 步骤1: 问题改写
                    if (data.step1ProblemRewriting) {
                        document.getElementById('step1Card').style.display = 'block';
                        updateStepStatus('step1', data.step1ProblemRewriting.status, data.step1ProblemRewriting.content);
                    }

                    // 检查是否为非数据库查询（只有步骤1有数据，其他步骤为null）
                    const isNonDatabaseQuery = data.step1ProblemRewriting && 
                                             !data.step2TableSelection && 
                                             !data.step3InformationInference && 
                                             !data.step4SqlGeneration && 
                                             !data.step5SqlExecution;

                    if (!isNonDatabaseQuery) {
                        // 正常数据库查询：显示所有有数据的步骤
                        // 步骤2: 数据表选取
                        if (data.step2TableSelection) {
                            document.getElementById('step2Card').style.display = 'block';
                            updateStepStatus('step2', data.step2TableSelection.status, data.step2TableSelection.content);
                        }

                        // 步骤3: 信息推理
                        if (data.step3InformationInference) {
                            document.getElementById('step3Card').style.display = 'block';
                            updateStepStatus('step3', data.step3InformationInference.status, data.step3InformationInference.content);
                        }

                        // 步骤4: SQL生成
                        if (data.step4SqlGeneration) {
                            document.getElementById('step4Card').style.display = 'block';
                            updateStepStatus('step4', data.step4SqlGeneration.status, data.step4SqlGeneration.content);
                        }

                        // 步骤5: SQL执行
                        if (data.step5SqlExecution) {
                            document.getElementById('step5Card').style.display = 'block';
                            updateStepStatus('step5', data.step5SqlExecution.status, data.step5SqlExecution.content);
                        }
                    }
                } catch (error) {
                    console.error('显示步骤结果时发生错误:', error);
                    alert('显示结果时发生错误: ' + error.message);
                }
            }, 100); // 短暂延迟确保所有数据都已接收
        }

        // 格式化步骤内容
        function formatStepContent(stepResult) {
            if (!stepResult) return '';
            
            let html = '';
            
            if (stepResult.content) {
                // 分割第一行（概要信息）和其余内容
                const lines = stepResult.content.split('\n');
                const briefInfo = lines[0] || '';
                const detailedInfo = lines.slice(1).join('\n').trim();
                
                html += '<div class="mb-3">';
                
                // 显示概要信息（第一行）
                if (briefInfo) {
                    html += '<div class="step-brief-info mb-2">';
                    html += convertMarkdownToHtml(briefInfo);
                    html += '</div>';
                }
                
                // 显示详细信息（其余内容）
                if (detailedInfo) {
                    html += '<div class="step-detailed-info">';
                    html += '<div class="mt-2">' + convertMarkdownToHtml(detailedInfo) + '</div>';
                    html += '</div>';
                }
                
                html += '</div>';
            }
            
            if (stepResult.status) {
                html += '<div class="mb-2">';
                html += '<strong>状态：</strong> ';
                if (stepResult.status === 'success') {
                    html += '<span class="badge bg-success">成功</span>';
                } else if (stepResult.status === 'failed') {
                    html += '<span class="badge bg-danger">失败</span>';
                } else {
                    html += '<span class="badge bg-secondary">' + stepResult.status + '</span>';
                }
                html += '</div>';
            }
            
            if (stepResult.error) {
                html += '<div class="alert alert-danger">';
                html += '<strong>错误：</strong> ' + stepResult.error;
                html += '</div>';
            }
            
            return html;
        }

        // 将 Markdown 转换为 HTML
        function convertMarkdownToHtml(markdown) {
            if (!markdown) return '';
            
            let html = markdown;
            
            // 转换SQL代码块 ```sql...``` -> <pre><code class="language-sql">...</code></pre>
            html = html.replace(/```sql\s*([\s\S]*?)```/gi, '<pre class="sql-code"><code class="language-sql">$1</code></pre>');
            
            // 转换普通代码块 ```...``` -> <pre><code>...</code></pre>
            html = html.replace(/```([\s\S]*?)```/g, '<pre class="sql-code"><code>$1</code></pre>');
            
            // 转换表格 | col1 | col2 | -> <table>...</table>
            html = html.replace(/\|(.+)\|\n\|[-\s|]+\|\n((?:\|.+\|\n?)*)/g, function(match, header, rows) {
                const headerCells = header.split('|').map(cell => cell.trim()).filter(cell => cell);
                const rowLines = rows.trim().split('\n').filter(line => line.trim());
                
                let tableHtml = '<div class="table-responsive"><table class="table table-striped table-sm table-hover">';
                
                // 表头
                tableHtml += '<thead class="table-dark"><tr>';
                headerCells.forEach(cell => {
                    tableHtml += '<th scope="col">' + cell + '</th>';
                });
                tableHtml += '</tr></thead>';
                
                // 数据行
                tableHtml += '<tbody>';
                rowLines.forEach(line => {
                    const cells = line.split('|').map(cell => cell.trim()).filter(cell => cell);
                    if (cells.length > 0) {
                        tableHtml += '<tr>';
                        cells.forEach((cell, index) => {
                            if (index === 0) {
                                tableHtml += '<th scope="row">' + cell + '</th>';
                            } else {
                                tableHtml += '<td>' + cell + '</td>';
                            }
                        });
                        tableHtml += '</tr>';
                    }
                });
                tableHtml += '</tbody></table></div>';
                
                return tableHtml;
            });
            
            // 转换粗体 **text** -> <strong>text</strong>
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // 转换斜体 *text* -> <em>text</em>
            html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // 转换行内代码 `code` -> <code>code</code>
            html = html.replace(/`([^`]+)`/g, '<code class="bg-light px-1 rounded">$1</code>');
            
            // 转换引用块（处理多行引用块）
            html = html.replace(/((?:^> .+$\n?)+)/gm, function(match) {
                const lines = match.trim().split('\n');
                const content = lines.map(line => line.replace(/^> /, '')).join('\n');
                return '<blockquote class="blockquote">' + content + '</blockquote>';
            });
            
            // 转换换行符 \n -> <br>（但不在pre标签内）
            html = html.replace(/\n/g, function(match, offset, string) {
                // 检查是否在pre标签内
                const beforeMatch = string.substring(0, offset);
                const preOpenCount = (beforeMatch.match(/<pre[^>]*>/g) || []).length;
                const preCloseCount = (beforeMatch.match(/<\/pre>/g) || []).length;
                return preOpenCount > preCloseCount ? '\n' : '<br>';
            });
            
            // 转换列表项（支持一级和二级列表）
            // 使用更智能的方法处理嵌套列表
            html = html.replace(/((?:^    - .+$\n?)+)/gm, function(match) {
                // 处理二级列表块
                const items = match.trim().split('\n').map(line => {
                    const content = line.replace(/^    - /, '');
                    return '<li class="ml-3">' + content + '</li>';
                }).join('');
                return '<ul class="mb-2">' + items + '</ul>';
            });
            
            // 修复一级列表的正则表达式，确保能正确匹配多行列表
            html = html.replace(/((?:^- .+$\n?)+)/gm, function(match) {
                // 处理一级列表块
                const items = match.trim().split('\n').filter(line => line.trim()).map(line => {
                    const content = line.replace(/^- /, '');
                    return '<li>' + content + '</li>';
                }).join('');
                return '<ul class="mb-2">' + items + '</ul>';
            });
            
            return html;
        }


    </script>
</body>
</html>
               